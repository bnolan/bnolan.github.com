<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
    <title>Ben Nolan - Home</title>
    <link rel="stylesheet" href="/stylesheets/reset.css" />
    <link rel="stylesheet" href="/stylesheets/text.css" />
    <link rel="stylesheet" href="/stylesheets/960.css" />
    <link rel="stylesheet" href="/stylesheets/ben.css" />
    <link rel="alternate" type="application/atom+xml" title="Ben Nolan - Atom" href="http://bnolan.github.com/atom.xml" />
  </head>
  <body>
    <div class="container_12">
      <div id="header" class="basic">

        <div class="heading">
          <h1 onclick="window.location='/'">
            <a href="/">Ben Nolan</a>
          </h1>
        </div>
      </div>
      
      <div class="clear"></div>

      <h2 class="subtitle">
        <span>I like to make software that is <em>fun</em> and <em>good looking</em>.</span>
      </h2>
      
      <div class="grid_8">
        
        
          <div class="grid_2">
            <div class="metadate">
              Sun
              October 24
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/10/24/new-twitter.html">New Twitter Analyzed</a></h3>
              <div class="postcontent preview">
                <p>I was interested to read the twitter engineering teams <a href='http://engineering.twitter.com/2010/09/tech-behind-new-twittercom.html'>overview</a> of how the newtwitter works.</p>

<p>This is the kind of app that is becoming more and more common, as it becomes viable to build apps in pure javascript, with just a json API as the backend. There are downsides to this kind of development, mostly in the inability for google to index the site - but for an app like twitter which are indexed by google using the pubsub interface (afaik), there&#8217;s no reason not to provide a pure javascript / html5 interface for modern browsers.</p>

<p>I haven&#8217;t got new twitter yet - so I hit up a friend and got him to send me the URLs for the new twitter javascript. I guessed the pre-closure URLS, tidied them up using html tidy and textmate - and we have these:</p>

<ul>
<li><a href='/science/newtwitter/base.txt'>base.js</a></li>

<li><a href='/science/newtwitter/phoenix.txt'>phoenix.js</a></li>
</ul>

<h1 id='basejs'>Base.js</h1>

<p>Base.js seems to contain their extensions to jquery to create the twitter &#8216;framework&#8217;, eg:</p>

<ul>
<li>Logging</li>

<li>Debugging</li>

<li>Stack traces</li>

<li>Browser detection</li>

<li>Analytics</li>

<li>Page state / history</li>

<li>Load templates</li>

<li>Form validation</li>

<li>Help</li>

<li>Autocomplete</li>
</ul>

<p>It also has some code that uses the anywhere api (I think), to find a user by screenname. It has a bunch of code that has either been handrolled, or gathered together from different jquery plugins (eg timeAgo, numberWithDelimiter).</p>

<p>The really interesting stuff is in phoenix.js though.</p>

<h1 id='phoenixjs'>Phoenix.js</h1>

<p>Newtwitter uses <a href='http://mustache.github.com/'>Mustache</a> for their templates. Many of these templates are included in phoenix.js, as twttr.templates. The templates are internationalized and use classes liberally - eg <code>stream-tab-following</code>, <code>stream-tab-pending</code>, <code>delete-saved-search</code>.</p>

<p>If you search on any of these classnames - you&#8217;ll find code later in phoenix.js that attaches the appropriate event handler to the html generated by mustache. For example - this fragment:</p>

<pre><code>&lt;div class=&#39;delete-saved-search&#39;&gt;
  \n &lt;a href=&#39;#&#39; class=&#39;delete-saved-search-x&#39;&gt;&lt;/a&gt;\n &lt;a href=&#39;#&#39;&gt;Remove saved search&lt;/a&gt;\n
&lt;/div&gt;&quot;,</code></pre>

<p>Has behaviour attached to it like so:</p>

<pre><code>click({
&quot;.delete-saved-search&quot;: function(B, A) {
    twttr.dialogs.deleteSavedSearch(twttr.bind(this,
    // ....
    B.stopPropagation();
    B.preventDefault();
    return false
})</code></pre>

<p>I&#8217;ve munged the code up a bit here, but you get the basic idea. Phoenix.js includes jquery (the latest release, 1.4.2), Jquery UI (1.8.4), <a href='http://www.modernizr.com/'>Modernizer</a> (a library for detecting browser support for various html5 functionality), <a href='http://benalman.com/code/test/js-linkify/'>Linkify</a>.</p>

<p>This was just a quick analysis of the newtwitter codebase - but I found all the mentions of <code>twttr.view</code> to be interesting - it seems like the twitter engineering team have built quite a strong framework for javascript apps - I wonder if they&#8217;ll release their MVC framework for other developers to create similair apps?</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/10/24/new-twitter.html#disqus_thread">New Twitter Analyzed</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Thu
              September 23
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/09/23/varnish-and-rails.html">Varnish and Rails</a></h3>
              <div class="postcontent preview">
                <p>I got my R scripts running on production for <a href='http://twitterplaces.com/'>twitterplaces</a> - so if you browse to <a href='http://twitterplaces.com/wlg'>Wellington</a> or <a href='http://twitterplaces.com/lon'>London</a>, you can see twitter densities. That&#8217;s all well and good and very rough, there&#8217;s a lot of work to do:</p>

<ol>
<li>The time slider looks rubbish</li>

<li>The tweet frequency histogram isn&#8217;t adjusted for the cities time offset</li>

<li>The extents of the different cities are different, so you get elongated contours</li>

<li>The contour needs to be subdivided for smoothness</li>

<li>It would be good to weigh against multiple tweets from a user</li>
</ol>

<p>But the first problem, is that the contours are exceptionally expensive to convert to json, which is done on every page load by ruby. I wanted to have an easy way to cache a page for 60 seconds, so that if the page gets &#8216;seagulled&#8217; (a thousand people follow a link from techcrunch, look at the page for a second, then go back to techcrunch to comment &#8216;it doesnt scale get nosql why not use php&#8217;) the site doesn&#8217;t go down.</p>

<h1 id='ask_koz'>Ask Koz</h1>

<p>I originally was going to do some apache rewriterule hax, but first I asked <a href='http://twitter.com/nzkoz'>@nzkoz</a>, who told me to look into <a href='http://www.varnish-cache.org/'>Varnish</a>. Varnish looked good so I gave it a go.</p>

<h1 id='varnish'>Varnish</h1>

<p>I followed the installation instructions <a href='http://www.varnish-cache.org/installation/ubuntu'>for Ubuntu</a>, then edited <code>/etc/defaults/varnish</code> to make varnish listen on port 80.</p>

<pre><code>DAEMON_OPTS=&quot;-a :80\
             -T localhost:6082 \</code></pre>

<p>I edited <code>/etc/apache2/ports.conf</code> to move apache over to port 8080:</p>

<pre><code>NameVirtualHost *:8080
Listen 8080</code></pre>

<p>And edited the appropriate <code>sites-available</code> scripts to move the virtual hosts over to the new port. Then I edited my <code>/etc/varnish/default.vcl</code> (make sure you install Varnish 2.x, not the 1.x that comes with some old varieties of Ubuntu) like so:</p>

<pre><code>sub vcl_recv {
        unset req.http.Cookie;
}
  
sub vcl_fetch {
        if (req.request == &quot;GET&quot;) {
                unset beresp.http.Set-Cookie;
                set beresp.cacheable = true;
                set beresp.ttl = 60s;
        }

        if (req.url ~ &quot;^/images/&quot; || req.url ~ &quot;^/javascripts&quot; || req.url ~ &quot;^/stylesheets&quot;){
                set beresp.ttl = 15m;
        }
}</code></pre>

<p>All GETs are cached for 60 seconds. Javascripts, images and stylesheets are cached (on the client side) for 15 minutes.</p>

<p>Note that this varnish config will annihilate any site that uses cookies - but twitterplaces (and weheartplaces) currently don&#8217;t use cookies at all - so everyones looks at the same pages. I then restarted varnish and <em>voila</em>, we have a fast cached site that can cope with some seagulling.</p>

<p>To check that things are working - I tailed my rails log, hit the site up with <code>curl -I http://twitterplaces.com/wlg/</code> and each request was served correctly, but didn&#8217;t show up in the rails logs until 60 seconds had elapsed. Varnish is very clever and will serve the old version of the cached page until the new version has finished regenerating. Varnish really does seem like a neat bit of kit.</p>

<p>Elapsed time, from learning of Varnish, to installing, configuring, testing and writing this blog post - 45 minutes.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/09/23/varnish-and-rails.html#disqus_thread">Varnish and Rails</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Wed
              September 22
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/09/22/r-on-ubuntu.html">Moving to production</a></h3>
              <div class="postcontent preview">
                <p>I lied. I wasn&#8217;t really building twitterplaces, I just got back from 5 days snowboarding, relaxing and reading books by the fire. Now i&#8217;m back in the office and started the week with getting my production box set up so I can deploy the next release of <a href='http://twitterplaces.com/'>twitterplaces</a>.</p>

<h1 id='monit'>Monit</h1>

<p>I set up a monit task to run my tweet importer and restart the process if it dies. The monit task looks like:</p>

<pre><code>check process importer
	with pidfile /tmp/importer.pid
    	start program = &quot;/usr/bin/sudo -u ben /var/www/tp/script/runner -e production Tweet.import&quot; with timeout 20 seconds
    	stop program  = &quot;/bin/kill -TERM `cat /tmp/importer.pid`&quot;</code></pre>

<p>Note that this job requires monit 5 since it uses the <code>with timeout</code> parameter. I also added this line to my importer script so that it spits out the process id.</p>

<pre><code>`echo #{Process.pid} &gt; /tmp/importer.pid`</code></pre>

<h1 id='r_and_odbc'>R and ODBC</h1>

<p>For my R scripts, I&#8217;ve been using the postgres adapter so that I can query directly from within R. It turns out the package I was using on the desktop wasn&#8217;t available on ubuntu, so I followed the instructions <a href='http://ubuntuforums.org/showthread.php?t=614715'>here</a> and <a href='http://simon.bonners.ca/blog///blog5.php/2010/03/13/accessing-a-postgresql-database-from-r-using-rodbc'>here</a> to get <code>RODBC</code> set up with postgres.</p>

<h1 id='future_tasks'>Future tasks</h1>

<p>I have a few things left to do before the new release is complete and ready for people to use:</p>

<ol>
<li><strong>Data massaging</strong> - the production database needs massaging and normalization of the bounding boxes for cities - I&#8217;ve been doing this adhoc, but it needs to be integrated into the twitter import process.</li>

<li><strong>Data analysis cronjobs</strong> - some of the data analysis jobs are best run hourly (for example the contour map generation), so these need to be scheduled as a cronjob</li>

<li><strong>Postgres partitioning</strong> - twitterplaces now imports over 2m tweets a day. To reduce the load on postgres, I&#8217;m going to use <a href='http://www.postgresql.org/docs/current/static/ddl-partitioning.html'>partitioning</a> to reduce the size of the indices and quicker data truncation (I can just drop week old tables, instead of a delete and vacuum).</li>
</ol>

<p>Hopefully i&#8217;ll be able to get some of that out later this week.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/09/22/r-on-ubuntu.html#disqus_thread">Moving to production</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Thu
              September 16
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/09/16/regular-transmissions.html">A break in transmission</a></h3>
              <div class="postcontent preview">
                <p>I&#8217;m taking a week off blogging so I can focus on <b>building</b>. Please excuse my silence - and I look forward to resuming communications with you all sometime next week.</p>
<img src='http://farm5.static.flickr.com/4133/4990723483_c1a4f97d5b.jpg' /><cite>Manners mall redevelopment</cite>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/09/16/regular-transmissions.html#disqus_thread">A break in transmission</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Wed
              September 15
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/09/15/twitterplaces-ng.html">Twitterplaces Next Generation</a></h3>
              <div class="postcontent preview">
                <p>Ever since I <a href='http://bennolan.com/2010/09/13/a-world-of-tweets.html'>discovered</a> that you can index all of the worlds geotagged tweets with Twitter, I&#8217;ve been working on the next generation of twitterplaces. It&#8217;s a challenge. The app has to work on datasets the size of Wellington (around 110 tweets per day) to New York (around 15k tweets per day) and provide an intimate experience for every user.</p>

<p>One of the biggest problems with displaying lots of data on a map is that you end up with massive clouds of google markers all over the map. These look okay when there&#8217;s less than 5 markers, but above that, clicking on many markers is a bad user experience, it&#8217;s hard to get an aggregate view of what&#8217;s going on.</p>
<img src='/images/twng.png' /><cite>Viewing wellington tweets grouped by contour density maps</cite>
<p>I&#8217;ve already posted about using R to create contour maps of tweet density. I&#8217;ve now taken that code and changed it from a manual job, into something automated. It&#8217;s not production ready yet - but the idea is:</p>

<ol>
<li>Contour generator (R script) runs hourly on top 1000 cities</li>

<li>R queries postgres for tweets in the last hour</li>

<li>Generate the density matrix, and generate contour lines</li>

<li>Convert contours into <a href='http://postgis.refractions.net/docs/ch04.html#RefObject'>WKT</a> polygons and save to the database</li>
</ol>

<p>When you display a city page - you export the contour polygons into a json array (indexed by hour) and then give the user some UI for changing what time window they are looking at.</p>

<h1 id='realtime_contour_generation'>Realtime contour generation</h1>

<p>I&#8217;m not in a hurry to try and do this in realtime, but it has been at the back of my mind. My bookmarks tagged <a href='http://www.delicious.com/benn/contour'>contour</a> have my notes on the basic algorithm. Any query that filters keyword, user_id, generate contour maps of an individual suburb, do language analysis, sentiment analysis, etc - would generate data suitable for converting into contour maps.</p>

<p>If I wanted to be able to generate this data in realtime, there are two ways I can see of doing it.</p>

<ol>
<li>Farm the raw tweet data off to the browser and generate the contour lines in Javascript</li>

<li>An optimized C++ app that uses sse / simd to generate the contour lines in a fraction of the time of R</li>
</ol>

<p>Or - I could charge customers monthly, fire up another ec2 instance and keep using the existing queries in R.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/09/15/twitterplaces-ng.html#disqus_thread">Twitterplaces Next Generation</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Tue
              September 14
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/09/14/panasonic-lumix.html">Panasonic Lumix and the Optimal Prime</a></h3>
              <div class="postcontent preview">
                <p>I&#8217;ve been waiting to make this post for a few weeks now. I bought a Pansonic Lumix GF1 with the 20mm prime (non-zoomable) lens. It&#8217;s a real beauty! It takes lovely photos, is a joy to use (nice and fast) and fits in my coat pocket. I bought it as a present to myself for three months working for Lonely Planet in Melbourne.</p>

<h1 id='choosing_the_gf1'>Choosing the GF1</h1>

<p>I got interested in a camera with a nice prime lens after seeing all <a href='http://www.flickr.com/photos/maddiontour'>Maddis</a> epic photos. He uses a sony Alpha and the minolta beercan lens. I started researching and quickly became interested in getting an <a href='http://www.photographyblog.com/reviews/sony_a330_review/'>a330</a> and hunting down some 80s lenses - but as I read around the net about small form factor dslrs, I kept seeing micro four thirds being mentioned, in particular the GF1.</p>

<p>This <a href='http://www.dpreview.com/reviews/PanasonicGF1/'>review</a> at dpreview and <a href='http://craigmod.com/journal/gf1-fieldtest/'>craigmods</a> gf1 review were the articles that really sold me on the GF1. It&#8217;ll be fun to pack up our house into a big box and then go travel the world with this camera hanging off my neck.</p>
<img src='http://farm5.static.flickr.com/4145/4985753541_25ab2b35d9_z.jpg' /><cite>Sweet Mothers Kitchen. Taken with the 20mm pancake lens</cite>
<p>See more photos from last night on this <a href='http://www.flickr.com/photos/benn/sets/72157624946265944/with/4985753541/'>flickr set</a>.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/09/14/panasonic-lumix.html#disqus_thread">Panasonic Lumix and the Optimal Prime</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Mon
              September 13
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/09/13/a-world-of-tweets.html">A world of tweets</a></h3>
              <div class="postcontent preview">
                <p>The Twitter streaming API now lets you recieve all geotagged tweets, not just geotagged tweets in specified areas. This means that with a command like:</p>

<pre><code>curl -d &quot;locations=-180,-90,180,90&quot; http://stream.twitter.com/1/statuses/filter.json -uuser:pass</code></pre>

<p>You can recieve all the geotagged tweets twitter has. I updated my crawler to run against this complete dataset, fixed a few lingering bugs, and then let my crawler run for a few hours:</p>
<img src='/images/ooo.png' /><cite>o's indicate exact location, .'s indicate neighbourhood</cite>
<p>I then exported my tweets, and plotted x vs y in R:</p>
<img src='/images/worldtweets.png' /><cite>plot(tweets$x, tweets$y); world(add=TRUE)</cite>
<p>You can clearly see a world map forming, with a great concentration of geotagged tweets in north america, europe, japan and indonesia, as well as the outlines of Australia and New Zealand.</p>

<p>What if we cluster the points using <code>kmeans</code>?</p>
<img src='/images/kmeans.png' /><cite>Clustered into 5 groups using kmeans squared</cite>
<p>We get 5 clusters, western us, eastern us, europe, asia and south america. Looks like Texas is an eastern state then. It&#8217;s kind of scary that Africa is so sparse that it gets gobbled up by Europe, South America and Asia.</p>

<p>I&#8217;m keen to see what a histogram of seconds from midnight (what I call epoch) and longitude will look like - but i&#8217;ll have to wait til I have 24 hours of data. It looks like I&#8217;ll end up with about 2 million tweets per 24 hour period, which should make a good dataset.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/09/13/a-world-of-tweets.html#disqus_thread">A world of tweets</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Fri
              September 10
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/09/10/contour-maps.html">Contour maps of tweet density</a></h3>
              <div class="postcontent preview">
                <p>I regenerated by tweet density graphs using contour lines, and got this nice looking animation of tweet density in london over the course of a day.</p>
<object height='400' width='400'><param name='movie' value='http://www.youtube.com/v/XMNg1Hjd6qE?fs=1&amp;hl=en_US' /><param name='allowFullScreen' value='true' /><param name='allowscriptaccess' value='always' /><embed src='http://www.youtube.com/v/XMNg1Hjd6qE?fs=1&amp;hl=en_US' allowfullscreen='true' type='application/x-shockwave-flash' allowscriptaccess='always' height='400' width='400' /></object><br /><br /><cite>24 hours of tweets in London</cite><br />
<p>The important improvements:</p>

<h2 id='use_a_sliding_time_window'>Use a sliding time window</h2>

<p>Before I was using hourly updates, which meant that the updates were quite abrupt, and I could have a maximum of 24 frames per movie. I used this subquery to pull out the number of seconds since midnight, so that I could use a sliding time window of one hour in R:</p>

<pre><code>extract(epoch from created_at::time)</code></pre>

<h2 id='use_contour_lines'>Use contour lines</h2>

<p>The <code>contour</code> function in R generates really nice contours from heightmaps. They look nice, and are easily georeferenced.</p>

<h2 id='resample_the_density_matrix'>Resample the density matrix</h2>

<p>I sample the tweets in a 50x50 matrix. This works, but gives quite sharp contour lines. The <code>image.smooth</code> function (from the image library) came in handy here, as it uses a gaussian smoothing kernel on each element in the matrix. The default settings gives a nice smooth heightfield which can be plotted by contour</p>

<h2 id='next_steps'>Next steps</h2>

<p>After this - I worked out that I could call <code>contourLines</code> to get the line coordinates. Then by converting this to json using <code>rjson</code>, I plotted the contourlines onto a google map using polygons. Finally, I made it so that you can click on the polygons, and see what tweets and neighbourhoods are causing weird spikes of activity.</p>

<p>I&#8217;m busy with client work at the moment, so hopefully sometime next week I can push an update to <a href='http://twitterplaces.com/'>twitterplaces</a> that features these contour maps.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/09/10/contour-maps.html#disqus_thread">Contour maps of tweet density</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Wed
              September 08
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/09/08/imperial-march.html">Imperial March</a></h3>
              <div class="postcontent preview">
                <p>One of the benefits from working at home is that I get to play trumpet and guitar as much as I want. Which means lots of time to practise.</p>
<object height='320' width='400'><param name='movie' value='http://www.youtube.com/v/ZiXNUzFYvmw?hl=en&fs=1' /><param name='allowFullScreen' value='true' /><param name='allowscriptaccess' value='always' /><embed src='http://www.youtube.com/v/ZiXNUzFYvmw?hl=en&fs=1' allowfullscreen='true' type='application/x-shockwave-flash' allowscriptaccess='always' height='320' width='400' /></object><br /><br />
<p>For some reason, practising lots of the trumpet isn&#8217;t helping me get better at all.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/09/08/imperial-march.html#disqus_thread">Imperial March</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Tue
              September 07
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/09/07/tweet-map-in-r.html">Tweet map in R</a></h3>
              <div class="postcontent preview">
                <p>Just as a quick follow up to yesterdays post - this is the very rough visualization I came up with using R, openGL and ffmpeg.</p>
<object height='320' width='400'><param name='movie' value='http://www.youtube.com/v/iqz6skQLkaQ?fs=1&amp;hl=en_US' /><param name='allowFullScreen' value='true' /><param name='allowscriptaccess' value='always' /><embed src='http://www.youtube.com/v/iqz6skQLkaQ?fs=1&amp;hl=en_US' allowfullscreen='true' type='application/x-shockwave-flash' allowscriptaccess='always' height='320' width='400' /></object><br /><br />
<p>The r script used was something like this. The texture isn&#8217;t correctly georeferenced, and needs to be flipped 180Â°, but this was as far as I got before having to move onto other work.</p>

<pre><code>ourplot &lt;- function (h) {
  north = 51.6
  south = 51.4
  east = 0.05
  west = -0.25

  df &lt;- subset(tweets, x &gt; west &amp; x &lt; east &amp; y &lt; north &amp; y &gt; south &amp; hour == h)

  df &lt;- rbind(df, data.frame(x=east, y=north, hour=-1))
  df &lt;- rbind(df, data.frame(x=west, y=south, hour=-1))

  hdf &lt;- hist2d(df$x, df$y, nbins=50, show=FALSE)

  persp3d( 
    hdf$x, 
    hdf$y, 
    hdf$counts, 
    ticktype=&quot;detailed&quot;,
    xlab=&quot;Longitude&quot;,
    ylab=&quot;Latitude&quot;,
    zlab=&quot;# Tweets&quot;,
    zlim=c(-30,50),
    expand=0.5, 
    shade=1.0, 
    specular=&quot;white&quot;,
    col=&quot;white&quot;,
    texture=&quot;/tmp/london.png&quot;,
    box=FALSE,
    axes=FALSE
  )

  rgl.snapshot(paste(&quot;/tmp/london-3d-&quot;,h,&quot;.png&quot;,sep=&quot;&quot;))
}

for (hour in seq(0,24,by=1)) ourplot(hour)</code></pre>

<p>I have a vague plan of taking the histogram matrix, exporting it to json and using protovis to redraw the graphs, possibly as a <a href='http://vis.stanford.edu/protovis/ex/stream.html'>streamgraph</a>.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/09/07/tweet-map-in-r.html#disqus_thread">Tweet map in R</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Mon
              September 06
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/09/06/plotting-choropleths-with-r.html">Plotting Choropleths with r</a></h3>
              <div class="postcontent preview">
                <p>Choropleths are those <a href='http://flowingdata.com/2009/11/12/how-to-make-a-us-county-thematic-map-using-free-tools/'>heatmap style</a> maps you often see. I&#8217;ve been keen to render some heatmaps out of the <a href='http://twitterplaces.com'>twitterplaces</a> data I have, so I spent today learning R and using it to generate some graphs.</p>

<p>First up - I installed R using the os x binaries, then went right on to install rgdal.</p>

<h2 id='installing_rgdal_on_snow_leopard'>Installing rgdal on snow leopard</h2>

<p>To load map data, you first need to install the PROJ and <a href='http://www.kyngchaos.com/software:postgres'>GDAL frameworks</a>. Then you need to install the R bindings for GDAL. When you try and install RGDAL from source - you may get this error:</p>

<pre><code>Error: gdal-config not found
The gdal-config script distributed with GDAL could not be found.</code></pre>

<p>To let R know where gdal and proj are - try this:</p>

<pre><code>install.packages(&quot;rgdal&quot;, configure.args = &quot; \
  --with-gdal-config=/Library/Frameworks/GDAL.framework/unix/bin/gdal-config \
  --with-proj-include=/Library/Frameworks/PROJ.framework/unix/include \
  --with-proj-lib=/Library/Frameworks/PROJ.framework/unix/lib \
&quot;,type=&quot;source&quot;)</code></pre>

<p>R packages install super fast for me, rgdal took about 30 seconds to build and install. I&#8217;m beginning to see why people like this package.</p>

<h2 id='plotting_california_state_boundies'>Plotting california state boundies</h2>

<p>Download the <a href='http://www.census.gov/geo/www/cob/co2000.html'>california shape files</a> from the US census, then load the data and plot it:</p>

<pre><code>cali=readOGR(&quot;/tmp&quot;,&quot;co06_d00&quot;)
plot(cali)</code></pre>

<p>You should get a graph of californian country boundaries:</p>
<img src='/images/choropleth/cali.png' /><cite>Plot of US census geo data</cite>
<p>Now to extract data from my twitter data.</p>

<h2 id='generating_neighbourhood_shapefiles'>Generating neighbourhood shapefiles</h2>

<p>As I import tweets from the twitter firehose, I create records in my place table that store the geometry data in a postgis <code>polygon</code> field. This means I can use <code>pgsql2shp</code> to extract the geometry data and create shape files that can be loaded into arcgis explorer, or imported into R using the readOGR command.</p>

<p>To generate my shape file - I run something like:</p>

<pre><code>pgsql2shp -f london -u postgres tp_dev &quot;select \
  name, geom \
from \
  places \
where \
  kind=&#39;neighborhood&#39; and city_id=( \
    select id from cities where name=&#39;London&#39; \
  )&quot;</code></pre>

<p>Which gives me 115 rows, all of the neighbourhoods in London that I have crawled so far. Plotting this data in R:</p>
<img src='/images/choropleth/london.png' /><cite>Plot of London twitter neighbourhoods</cite>
<p>Twitter uses <a href='http://www.maponics.com/products/gis-data/neighborhood-boundaries/overview/'>third party data</a> to geocode your tweets. Sadly, the neighbourhood data isn&#8217;t free, so twitter can only share bounding boxes, which is why the map is all boxes.</p>

<p>In the future I might try querying openstreetmap for <a href='http://wiki.openstreetmap.org/wiki/Tag:boundary%3Dadministrative'>boundary data</a> of administration areas 9 and 10, but I&#8217;m not sure how complete that data is.</p>

<h2 id='getting_tweet_frequency'>Getting Tweet frequency</h2>

<p>I re-ran the neighbourhood shape file dump, to include the number of users tweeting from each neighbourhood in london. The query ended up looking something like this:</p>

<pre><code>select \
  id, geom, name, ( \
    select count(distinct user_id) from tweets where place_id=places.id \
  ) as user_count \
from \
  places \
where \
  city_id=( \
    select id from cities where name=&#39;London&#39; \
  ) AND kind = &#39;neighborhood&#39; \
order by \
  user_count desc;</code></pre>

<p>I can then load this data into R, create a blue palette and plot it in 3 lines:</p>

<pre><code>pal &lt;- brewer.pal(9,&quot;Blues&quot;)
plot(lon,col=pal[9 - (lon$USER_COUNT * 9 / max(lon$USER_COUNT))],border=&quot;white&quot;)</code></pre>

<p>The graph however - is kinda disappointing, since the overlapping bounding boxes - combined with some very large neighbourhood areas, makes the graph pretty much useless.</p>
<img src='/images/choropleth/london-heatmap.png' /><cite>Darker blue represents more tweets</cite>
<h2 id='two_dimensional_histogram'>Two dimensional histogram</h2>

<p>After failing at my first graphing experiment, I tried plotting a two dimensional histogram of tweets. First up - spit out all the lats and longs of tweets from postgres. I haven&#8217;t installed the r&lt;-&gt;postgres bindings yet, so I have to export to CSV and then import to R.</p>

<p>Enable CSV export from psql.</p>

<pre><code>\f &#39;,&#39; 
\a
\pset footer off
\o /tmp/tweets.csv</code></pre>

<p>Then query&#8230;</p>

<pre><code>select 
  st_x(geom) as x, st_y(geom) as y, extract(hour from created_at) as hour 
from
  tweets 
where 
  geom is not null
and
  st_x(geom) &lt; -100</code></pre>

<p>This also gives us the hour of the day that the tweet was made, which might come in handy later. I loaded this data into R, then I could plot a scatter graph:</p>

<pre><code>tweets &lt;- read.csv(&quot;/tmp/tweets.csv&quot;)
plot(tweets$x, tweets$y)</code></pre>

<p>Gives a random looking graph with a concentration of points around the mission.</p>
<img src='/images/choropleth/scatter-sfo.png' /><cite>A scattergraph of 1600 geotagged tweets around San Francisco</cite>
<p>Okay - what does this look like as a 2d histogram?</p>

<pre><code>hist2d(tweets$x,tweets$y)</code></pre>
<img src='/images/choropleth/heat-sfo.png' /><cite>A 2d histogram of tweets around San Francisco</cite>
<p>Starting to get interesting - but still way too sparse. Let&#8217;s trim the area down to only include San Francisco proper, from the Marina District in the north, to the mission in the south.</p>

<pre><code>city &lt;- subset(tweets, y &lt; 37.808 &amp; y &gt; 37.750 &amp; x &lt; -122.370 &amp; x &gt; -122.457)</code></pre>

<p>Then let&#8217;s plot it in perspective 3d</p>

<pre><code>h &lt;- hist2d(city$x, city$y, nbins=25)
persp( 
  h$x, 
  h$y, 
  h$counts, 
  ticktype=&quot;detailed&quot;, 
  theta=30, 
  phi=30, 
  expand=0.5, 
  shade=0.5, 
  col=&quot;cyan&quot;, 
  ltheta=-30
)</code></pre>
<img src='/images/choropleth/sfo-persp.png' /><cite>User count in San Francisco rendered in a perspective view</cite>
<p>The mission / cbd is in the top right of this graph, so you can see where most people are during the day.</p>

<h2 id='animating_the_graph_over_time'>Animating the graph over time</h2>

<p>This is rendering 5 hours of data on one graph, but I was interested to see how the activity looked on an hourly basis, so I wrote a little R script to re-render the graph for each hour of the day, which may be a topic for tomorrows blog post.</p>

<p>nb: Note that I never actually created realistic looking choropleths in this post. ;D</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/09/06/plotting-choropleths-with-r.html#disqus_thread">Plotting Choropleths with r</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Fri
              September 03
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/09/03/art-on-fridays.html">Specialization and Art</a></h3>
              <div class="postcontent preview">
                <p>I like <a href='http://elise.com/quotes/a/heinlein_-_specialization_is_for_insects.php'>Heinleins quote</a>, so instead of Follow Friday, I decided to try and post Art on Friday. So, an old charcoal drawing that&#8217;s been hanging in my office, and 90 seconds of my acoustic guitar.</p>
<img src='/images/charcoal-drawing.jpg' /><cite>Drawn at <a href='http://www.vincents.co.nz/'>Vincents</a> life drawing class in 2008</cite>
<p>A warning - I made the guitar track up as I went along, so it&#8217;s pretty rough eh.</p>
<audio controls='true' src='/tracks/friday-acoustic.mp3' autobuffer='true'> </audio><cite>Something around Am and C, on my Tanglewood acoustic</cite>
<p>The track was recorded by the imac&#8217;s internal microphone (I need to get a 9 volt battery so I can use the pick-ups on the acoustic), so sounds a bit like it was recorded in a tin can.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/09/03/art-on-fridays.html#disqus_thread">Specialization and Art</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Thu
              September 02
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/09/02/what-to-drink.html">What to drink on Thursdays?</a></h3>
              <div class="postcontent preview">
                <p>I&#8217;ve been making a real effort to avoid coffee in the afternoon. I&#8217;ve made the discovery that although the first cup of coffee in the morning is awesome, afternoon coffees are just that &#8216;cup of stress&#8217; that my vegan friends talk about.</p>

<p>So I made myself a handy guide to what I should drink, hour by hour, on Thurdays.</p>
<img src='/images/drinks.jpg' /><cite>Tea... Wins!</cite>
<p>The beer is optional, although I was planning on catching up with <a href='http://chillu.com/'>Herr Schommer</a> after work.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/09/02/what-to-drink.html#disqus_thread">What to drink on Thursdays?</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Wed
              September 01
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/09/01/polygons-and-postgis.html">Polygons and postgis</a></h3>
              <div class="postcontent preview">
                <p>I use <a href='http://postgis.refractions.net/'>postgis</a> extensively in my geo-local development. If you&#8217;re working on a project that involves geo data and you haven&#8217;t seriously looked into postgis, you&#8217;re doing yourself a disfavour.</p>

<p>Postgres is really quite epic.</p>

<ul>
<li>Postgis</li>

<li><a href='http://rpgsql.sourceforge.net/'>R for Postgres</a></li>

<li><a href='http://www.pygresql.org/'>Python for Postgres</a></li>

<li>A nice stable API for creating C++ extensions</li>
</ul>

<p>We used the C++ API to make a <a href='http://xapian.org/'>xapian</a> plugin for <a href='http://zoomin.co.nz/'>zoomin</a>, back in the day before <a href='http://www.sai.msu.su/~megera/postgres/gist/tsearch/V2/'>tsearch2</a> became integrated into Postgresql.</p>

<h2 id='twitterplaces'>Twitterplaces</h2>

<p><a href='http://twitter.com/sminnee/'>Sam</a> asked that I add polygons onto my <a href='http://twitterplaces.com/sfo/soma'>twitterplaces maps</a>, so that he could see where the boundaries of a neighbourhood are.</p>
<img src='/images/soma-tp.png' /><cite>South of Mission on Twitterplaces</cite>
<p>The twitter places API gives you the bounding boxes of a place, so I already had the information, it was just a case of how to store the bounding boxes. I decided to do it properly and use <a href='http://github.com/fragility/spatial_adapter'>spatial_adapter</a> and a :polygon column in my places table.</p>

<p>This meant I could use a method like so:</p>

<pre><code>def bounding_box=(params)
  points = []

  params[&#39;coordinates&#39;].first.each do |c|
    points.push GeoRuby::SimpleFeatures::Point.from_x_y(c.first, c.last)
  end

  self.latitude = points.collect(&amp;:y).sum / points.length
  self.longitude = points.collect(&amp;:x).sum / points.length

  c = params[&#39;coordinates&#39;].first.first
  points.push GeoRuby::SimpleFeatures::Point.from_x_y(c.first, c.last)
  self.geom = GeoRuby::SimpleFeatures::Polygon::from_points([points])
end</code></pre>

<p>To convert twitters json representation of a place into a WKRT geometry object in my database. This is cool, because then I can use some coffeescript like this to draw the polygon onto my maps.</p>

<pre><code>if $place.geom.rings
  points = []
  bounds = new google.maps.LatLngBounds

  for point in $place.geom.rings[0].points
    coord = new google.maps.LatLng(point.y, point.x)
    bounds.extend coord
    points.push coord

  if bounds.toSpan().lat() == 0.0 or bounds.toSpan().lng() == 0.0
    marker = new google.maps.Marker {
      map : map
      position : bounds.getCenter()
    }
  else
    poly = new google.maps.Polygon {
      paths : [points]
      map : map
      strokeColor : &#39;#ff0000&#39;
      strokeOpacity: 0.5
      fillOpacity : 0.1
      fillColor : &#39;#ff0000&#39;
    }</code></pre>

<p>That code also checks whether the polygon is degenerate (of zero size), and then plots a marker instead. Twitter always sends polygons, even if the polygon has zero area. Anyway. So this was all nice and took 15 minutes to code up. But it also let me do something super awesome:</p>

<pre><code>def find_child_pois
  Place.find(:all, :conditions =&gt; [&#39;kind = ? AND st_contains(?, geom)&#39;, &#39;poi&#39;, geom])
end</code></pre>

<p>I now have a method to find all places contained inside a place. So for example, <a href='http://twitterplaces.com/sfo/soma'>South of Mission</a> in San Francisco, has <a href='http://twitterplaces.com/sfo/adobe-systems-san-francisco'>Adobe Systems</a> inside of it. You can also find out which places contain this one - for example:</p>

<pre><code>&gt;&gt; Place.find_by_path(&#39;sfo/soma&#39;).find_parents.collect(&amp;:name)
=&gt; [&quot;San Francisco&quot;, &quot;SoMa&quot;, &quot;California&quot;]</code></pre>

<p>I was pretty excited when all this came together so well. When I&#8217;ve got more time, I&#8217;d like to fix up the crawler that feeds twitterplaces, since at the moment it just dumps the database and recreates it every hour from a sampling of the twitter firehose.</p>

<p>Ah - for more good hours in the day.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/09/01/polygons-and-postgis.html#disqus_thread">Polygons and postgis</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Mon
              August 30
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/08/30/agile-board.html">Agile board in html5</a></h3>
              <div class="postcontent preview">
                <p>I put <a href='/science/velocity/'>this together</a> as a quick prototype of what an agile board in HTML5 could look like. I&#8217;m not a huge agile fan myself, but since I keep having to use pivotal tracker in projects - I&#8217;m always tempted to do a little bit more work on it and get it to a usable state.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/08/30/agile-board.html#disqus_thread">Agile board in html5</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Sun
              August 29
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/08/29/batched-save.html">Batched save ruby module</a></h3>
              <div class="postcontent preview">
                <p>In my work on <a href='http://twitterplaces.com/'>twitterplaces</a> - I&#8217;ve been commonly importing several thousand tweets at once from the streaming API. As I re-write my import process, I have to re-run this import job, so I&#8217;ve been trying to get it as fast as possible. Currently what I do is:</p>

<ul>
<li>Use memcache</li>

<li>Use <a href='http://gist.github.com/555750'>batched_save</a></li>
</ul>

<p>Batched save is my module I created to let you <code>include BatchedSave</code> in a model, and then when you save a new record - it&#8217;ll batch up 100 records and use COPY to insert them. It is for postgresql only, and obviously only works in situations like mine where the data isn&#8217;t self-referential, but it&#8217;s mega fast.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/08/29/batched-save.html#disqus_thread">Batched save ruby module</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Fri
              August 27
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/08/27/10k-submission-accepted.html">My 10k submission was accepted</a></h3>
              <div class="postcontent preview">
                <p>Woohoo! Please go <a href='http://10k.aneventapart.com/Entry/394'>vote now</a>! It&#8217;s a bit lame they&#8217;ve got the unsexiest screenshot first, but&#8230; yay!</p>
<img src='/images/10kgallery.png' /><cite>My entry in the official 10k gallery</cite>
<p>There is a community prize that you win by getting the most votes - so if you like my submission, please spread the word.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/08/27/10k-submission-accepted.html#disqus_thread">My 10k submission was accepted</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Thu
              August 26
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/08/26/under-10240-bytes.html">All done - in under 10240 bytes</a></h3>
              <div class="postcontent preview">
                <p>Well, it&#8217;s done. I just submitted my entry to the <a href='http://10k.aneventapart.com/Entry/394'>10k apart</a> competition. It&#8217;s been a pretty intense 24 hours, but I&#8217;m glad I gave myself some extra time this morning to polish up my entry.</p>
<img src='/images/10kapart-preview.png' /><cite>Planning a trip to Paris, a screenshot from an earlier build</cite>
<p>You can <a href='http://10k.aneventapart.com/Entry/394'>try it out here</a> - all 9766 bytes of it.</p>

<h2 id='toolchain'>Toolchain</h2>

<p>I built the app using:</p>

<ul>
<li><a href='http://jashkenas.github.com/coffee-script/'>Coffeescript</a></li>

<li><a href='http://lesscss.org/'>Less CSS</a></li>

<li><a href='http://api.jquery.com/'>jQuery</a></li>

<li><a href='http://diveintohtml5.org/'>HTML5</a></li>

<li><a href='http://pdfcrowd.com/'>PDFCrowd</a></li>

<li><a href='http://code.google.com/apis/maps/documentation/staticmaps/'>Google Static Maps</a></li>

<li><a href='http://developer.yahoo.com/yui/compressor/'>YUI Compressor</a></li>

<li><a href='http://code.google.com/closure/'>Google closure</a></li>
</ul>

<p>I have some extra code that is commented out, that does an autocomplete from Wikipedia when you add a new destination to your trip. So for example, you could type &#8216;Montmar&#8217; and get an autocomplete for Montmartre. It&#8217;s nice because <span>a</span> I&#8217;m not very good at french spelling and <span>b</span> you automatically get some description text of the place from Wikipedia.</p>

<p>I also removed a column on the left that let you organise trips to different cities. I probably would&#8217;ve been pushing the 10k limit had I kept adding features, but mainly I didn&#8217;t have time to build and test the features properly. I enjoyed having time today to add some extra destinations to the trip, change the dates a little, and test the app thoroughly on each of the browsers.</p>

<h2 id='compression'>Compression</h2>

<p>I&#8217;d like to thank <a href='http://blog.nihilogic.dk/2008/05/compression-using-canvas-and-png.html'>Nihilogic</a> for their awesome canvas compression technique. Because I could compress the javascript and css so effectively, I didn&#8217;t have to muck around pruning bytes from my css and javascript, which meant I could spend more time polishing the app.</p>

<p>For reference - here&#8217;s the breakdown of the sizes of my CSS at different stages of my development pipeline. I used a simple bash script to compile, compress and package everything.</p>

<pre><code>|              | Source | Comp  | Opt  | PNG  |
| Less CSS     | 7143   | 7589  | 5961 | 1898 |
| Coffeescript | 11388  | 13742 | 9445 | 3879 |</code></pre>

<h2 id='internet_explorer_9'>Internet Explorer 9</h2>

<p>It&#8217;s been an interesting experience using IE 9. It looks like it&#8217;s going to be a good browser. I will still use Safari as my main browser and development tool (even if they did release IE9 for mac), but it looks like I&#8217;ll be supporting Safari 5, Chrome, Firefox 3.5 and IE 9 in all my future web apps.</p>

<h2 id='thanks'>Thanks</h2>

<p>I&#8217;d like to thank @sminnee, @ristari, @nzkoz, @clarketus, @nikz, @agrath, @terrcin, @lancehodges, @youdoham, @nazdrug and @campbell for their support, feedback and bug checking while I put this thing together. I couldn&#8217;t have got it done without you all, thanks.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/08/26/under-10240-bytes.html#disqus_thread">All done - in under 10240 bytes</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Wed
              August 25
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/08/25/why-not-consult.html">Why not consult?</a></h3>
              <div class="postcontent preview">
                <p>In the preparation for my leap back into the world of start-ups, I&#8217;ve been wondering why I don&#8217;t prefer to consult full-time. Consulting has a bunch of pros:</p>

<ol>
<li>Excellent pay</li>

<li>Challenging projects</li>

<li>Turn your brain off at 5pm</li>
</ol>

<p>It struck me today - that the main reason I don&#8217;t enjoy doing javascript / rails consulting is because I <em>can&#8217;t do it all day long</em>. I can do 4-5 hours of it and stay in flow, but after that it&#8217;s a real struggle. Sure I can churn out more code and fix bugs, but I&#8217;m not being creative, I&#8217;m overexercising the part of my brain that writes code.</p>

<p>And in a small business, that&#8217;s the perfect time of day to put away your text editor, open up skype, imovie and mail.app, and start down some of that marketing work.</p>

<p>I think this all comes back to Heinlein.</p>
<quote>Specialization is for Insects</quote>
<p>I want to be able to play the cello, climb a multipitch, fix a car, nurse a child, write a book, rally a crowd, run a marathon, pontificate on a beer, console a friend or any of a million more things.</p>

<p>Small business takes away your safety net, but it lets you try out as every act in the circus.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/08/25/why-not-consult.html#disqus_thread">Why not consult?</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Tue
              August 24
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/08/24/10k-apart.html">My 10k apart submission</a></h3>
              <div class="postcontent preview">
                <p>I haven&#8217;t had much time to look at the Facebook Places API, but I have been working on my <a href='http://10k.aneventapart.com/'>10k apart</a> submission. This competition challenges you to build a functioning web app in only 10 kilobytes of javascript, html and css.</p>

<p>I&#8217;ve decided to take an idea I&#8217;ve had kicking around (a trip planner for <a href='http://www.weheartplaces.com/'>weheartplaces</a>) and see if it can be polished up to fit into the 10k limit.</p>
<img src='/images/10kapart-preview.png' /><cite>Planning a trip to Paris, a screenshot from earlier this morning</cite>
<p>Using the command <code>ls -l *.css *.js *.html | awk &#39;{sum+=$5} END {print sum}&#39;</code> to sum up the bytes, I&#8217;m already up to 12k of content for the unoptimized code.</p>

<p>I&#8217;m aiming to keep the entire project under 20k in unoptimized form, which will hopefully make the 10k limit achievable. <a href='http://jashkenas.github.com/coffee-script/'>Coffeescript</a> and <a href='http://lesscss.org/'>less</a> output is quite verbose - and will benefit from <a href='http://code.google.com/closure/'>closure</a> and the <a href='http://developer.yahoo.com/yui/compressor/'>YUI compressor</a>.</p>

<p>Wish me luck. The deadline is lunchtime tomorrow (NZDT).</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/08/24/10k-apart.html#disqus_thread">My 10k apart submission</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Mon
              August 23
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/08/23/a-varied-gym-schedule.html">A varied gym schedule</a></h3>
              <div class="postcontent preview">
                <p>Like some web developers, I&#8217;m a bit ADD, so I find going to the gym a bit of a chore. Don&#8217;t get me wrong. I love the exercise, the clear headedness afterwards, the more energy you have in every day, the rest for your mind - a blissful 45 minutes where your brain doesn&#8217;t have to analyse pixels on a screen, or type strange patterns into the keyboard.</p>

<p>But spending 45 minutes with no mental stimulation - how dull is that! Especially when you go to the gym at quiet times (I don&#8217;t like noisy gyms), there&#8217;s not even anyone to talk to.</p>

<p>So my workout which is nice and varied is like so:</p>

<ol>
<li>3km rowing ~12 minutes</li>

<li>Situps, pushups and chins x3 sets ~15 minutes</li>

<li>Treadmill on hilly mode ~15 minutes</li>
</ol>

<p>I find the treadmill the hardest, since it&#8217;s just so dull - but I take it as a nice time to be all Zen (after the half an hour of exercise I find my inner Zen-buddha is easier to access). I set the treadmill to &#8216;randomly changing gradient&#8217;, so that your heart rate is constantly moving up and down.</p>

<p>Anyway - that works for me, and I&#8217;ve found it an easy workout to do consistently 4 times per week</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/08/23/a-varied-gym-schedule.html#disqus_thread">A varied gym schedule</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Fri
              August 20
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/08/20/a-facebook-place.html">Analyzing a places page</a></h3>
              <div class="postcontent preview">
                <p>Since Facebook places isn&#8217;t available outside of the US yet - I&#8217;ve only had two options for exploring the places api.</p>

<p>Firstly - my good friend <a href='http://twitter.com/clarketus/'>loliver</a> moved to Palo Alto two months ago to work for <a href='http://www.wildfireapp.com/'>Wildfire</a>, so I&#8217;ve been following his <a href='http://www.facebook.com/pages/Wildfire-HQ/119484554770490'>checkins</a>.</p>
<img src='/images/facebookplace-page.png' /><cite>Wildfire HQ Places page</cite>
<p>I love the design, it&#8217;s nice and simple, has a strong social component (with the facebook wall), had a piece of content in the middle of the page (the map), some stats on the left to get an idea of the popularity of this place - and then a list of people who have checked in there which gives some &#8216;explorability&#8217; to the places pages.</p>

<p>They don&#8217;t have &#8216;nearby&#8217; or &#8216;similair&#8217; places, but that might just be because it&#8217;s new and not enough of my friends have checked into multiple places.</p>

<h2 id='proxies_and_geolocation_hacks'>Proxies and geolocation hacks</h2>

<p>The other way I&#8217;ve been trying out the facebook is by proxying my requests through my US servers (which doesn&#8217;t seem necessary now that they&#8217;ve deployed the places functionality worldwide). The only downside is that when your browser tries to geolocate you, Facebook works out you&#8217;re not in the US and gives up.</p>

<p>The next trick for Monday will be to make a greasemonkey script that emulates the W3C geolocation API and let&#8217;s you check <a href='http://twitter.com/nzkoz/'>friends</a> into <a href='http://www.tuscl.net/s.php?SID=27'>Kentucky strip clubs</a>.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/08/20/a-facebook-place.html#disqus_thread">Analyzing a places page</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Thu
              August 19
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/08/19/facebook-places.html">Facebook Places</a></h3>
              <div class="postcontent preview">
                <p>I&#8217;m really excited about the release of <a href='http://developers.facebook.com/blog/post/403'>Facebook Places</a>. It&#8217;s not widely available yet but it should be rolled out to American Facebook users over the next 24 hours.</p>
<img src='/images/facebookplaces.png' /><cite>Facebook places on the iPhone</cite>
<p>The features:</p>

<ol>
<li>Checking in to places, for where you are at the moment</li>

<li>Tagging friends as being with you at a place</li>

<li>Seeing where your friends are and have been</li>

<li>An extensive API for accessing a users places data</li>
</ol>

<p>It&#8217;s number 4 that&#8217;s exciting to me. Facebook gives a bunch of examples of ways the API could be used - including:</p>

<p><em>A travel application that gives people the ability to see which of their friends have already been to the place they are visiting.</em></p>

<p>That&#8217;s kind of exactly what I&#8217;ve been building. Starting next week, I&#8217;ll be working on the re-release of <a href='http://www.weheartplaces.com/'>weheartplaces</a>, integrated with the Facebook Places api.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/08/19/facebook-places.html#disqus_thread">Facebook Places</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Wed
              August 18
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/08/18/we-heart-nokia.html">We Heart Nokia</a></h3>
              <div class="postcontent preview">
                <p>I&#8217;m excited to announce that weheartplaces will be available for Nokia Series 60 phones, as well as the iPhone and Android.</p>

<p>I&#8217;ll be using the Nokia Webruntime (WRT 1.0), a browser-based environment that effectively allows you to create web/javascript programs that masquerade as normal symbian applications. I&#8217;ve just been testing out the functionality of my <a href='http://www.nokia.com.au/find-products/all-phones/nokia-6220-classic?cid=ncomprod-fw-src-na-con-nokia_6220-google-au-20-nokia6220_117'>Nokia 6220</a>, which is a $150 phone with 3G, GPS, driving directions and a 5 megapixel camera.</p>
<img src='/images/weheartnokia.jpg' /><cite>I got the icon going! That's like 80% of the work right there.</cite>
<p>I&#8217;m not sure of the release date yet - but when it&#8217;s ready it&#8217;ll be available at my <a href='http://store.ovi.com/publisher/Nolan+Consulting/'>publishers page</a> on the Ovi store.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/08/18/we-heart-nokia.html#disqus_thread">We Heart Nokia</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Tue
              August 17
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/08/17/to-market.html">To Market!</a></h3>
              <div class="postcontent preview">
                <p>Are you in Wellington and are serious about starting a tech business? I got an email from the <a href='http://www.brightideaschallenge.co.nz/'>bright ideas challenge</a> with information about the following presentations, from various technical and business development peoples. I&#8217;ll be attending these three&#8230;</p>

<h2 id='strategy'>Strategy</h2>

<p>Value proposition, business model, pricing model, finances and sustainability - Monday, 30 August 2010.</p>

<h2 id='technical'>Technical</h2>

<p>Intellectual property strategy, legal and governance, prototyping and funding options - Monday, 6 September 2010.</p>

<h2 id='gotomarket'>Go-to-Market</h2>

<p>Go-to-market strategy, branding, exporting and distribution - Wednesday, 8 September 2010.</p>

<p>All events are held 4.30-6.30pm in the Memorial Theatre, Victoria University of Wellington. That marketing one sounds especially interesting.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/08/17/to-market.html#disqus_thread">To Market!</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Mon
              August 16
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/08/16/weird-bug-of-the-day.html">Weird bug of the day</a></h3>
              <div class="postcontent preview">
                <p>On Safari, it&#8217;s nice to use ellipsis to limit the length of text. However, a warning to young players - <code>text-overflow: ellipsis</code> doesn&#8217;t work with webfonts.</p>
<img src='/images/overflow-1.png' /><cite>Correctly functioning ellipsis styling</cite><img src='/images/overflow-2.png' /><cite>When using a webfont, Safari gives up, it's all too hard</cite>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/08/16/weird-bug-of-the-day.html#disqus_thread">Weird bug of the day</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Sun
              August 15
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/08/15/hey-what-does.html">Hey what does this button do?</a></h3>
              <div class="postcontent preview">
                <p>I&#8217;ve used photoshop for years and consider myself an intermediate user. You end up using photoshop a lot in webdesign to slice stuff up, or create decent logos - and prior to CSS3 it was my number one gradients tool. However - there&#8217;s a bunch of stuff photoshop doesn&#8217;t do.</p>

<p>With the advent of resolution-independent interfaces (retina display, next version of os x, landscape and portrait views of a site) and the need to create business cards, flyers, stickers and pixel art for websites - I&#8217;ve been learning Adobe Illustrator.</p>

<p>While playing with the <a href='http://www.weheartplaces.com/'>weheartplaces</a> logo - I discovered this menu item:</p>
<img src='/images/logos/menu.png' /><cite>Hey - what does this effect do?</cite><img src='/images/logos/cut6.png' /><cite>Houston. We have a logo.</cite>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/08/15/hey-what-does.html#disqus_thread">Hey what does this button do?</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Sat
              August 14
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/08/14/weheartplaces.html">Logo Design</a></h3>
              <div class="postcontent preview">
                <p>I&#8217;ve been working on logos and design rules for <a href='http://www.weheartplaces.com/'>Weheartplaces</a>, creating dozens of Artboards in illustrator. I&#8217;m not a designer by trade, so some of my design is a bit stilted, but bear with me and eventually there might be a nice logo and style for the site.</p>
<img src='/images/logos/cut1.png' /><cite>Dax, probably too strong a shadow.</cite><img src='/images/logos/cut2.png' /><cite>Eurostile, going cold on this one.</cite><img src='/images/logos/cut3.png' /><cite>Oh, hai Steve.</cite><img src='/images/logos/cut4.png' /><cite>The Scott Pilgrim special, plus Illustrator gradients.</cite><img src='/images/logos/cut5.png' /><cite>For legal correspondence only.</cite>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/08/14/weheartplaces.html#disqus_thread">Logo Design</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Fri
              August 13
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/08/13/pushstate-and-nodejs.html">Push state and Node.js</a></h3>
              <div class="postcontent preview">
                <p>I&#8217;ve talked with <a href='http://twitter.com/sminnee'>Sam Minnee</a> (CTO at <a href='http://silverstripe.com/'>Silverstripe</a>) a bunch of times about running jquery on the server side. It was only a hunch, I never knew exactly what the benefits would be - but with the availability of <a href='https://developer.mozilla.org/en/DOM/Manipulating_the_browser_history'>pushState</a> on Firefox, Safari and Chrome - it suddenly makes a lot of sense.</p>

<p>What pushState and jquery on the server lets you do - is to have a pure javascript application that doesnt require page reloads to go to different urls. For example:</p>

<ol>
<li>http://yourapp.com/</li>

<li>http://yourapp.com/search</li>

<li>http://yourapp.com/search/myterms</li>

<li>http://yourapp.com/tweet/12345</li>
</ol>

<p>Can all be generated client side by your jquery and coffeescript code. This is an awesome way to write an app, you get a good responsive app and it&#8217;s easy to persist state between pages (eg your google map won&#8217;t spring back to the default location everytime you click &#8216;back&#8217;).</p>

<p>The number one downfall of javascript apps, is that there are now pages in your app that can&#8217;t be linked to - nor can they be crawled by google, or scraped by any other site that uses the http protocol. Building exciting new apps that &#8216;break the internet&#8217; isn&#8217;t cool.</p>

<p>But if you can run your entire app on the server side - then if someone goes to <code>http://yourapp.com/search/myterms</code> - node.js can load your page on the server, recognize the url, run the correct javascript code to update the state as the browser would - then send it down the wire. So that non-javascript clients can access the same content that a desktop browser can.</p>

<p>It&#8217;s a whole new way to do accessibility.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/08/13/pushstate-and-nodejs.html#disqus_thread">Push state and Node.js</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Thu
              August 12
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/08/12/facebook-places.html">Facebook places</a></h3>
              <div class="postcontent preview">
                <p>This <a href='http://gigaom.com/2010/08/10/facebook-places-will-be-about-more-than-just-a-check-in/'>analysis by Gigaom</a> is interesting to me. I&#8217;m really keen to see what Facebook does with places. What they&#8217;ve done so far has been underwhelming technically, but has seen impressive takeup.</p>

<p>For example - try searching for <a href='http://apps.facebook.com/weheartplaces/places/935148524-hashigo_zake'>Hashigo Zake</a> (a Wellington beer bar popular with early adopters / geeks) on various services:</p>

<ul>
<li><a href='http://www.facebook.com/pages/Wellington-New-Zealand/Hashigo-Zake/144268315585'>Facebook page</a> - 413 people, 100s of posts</li>

<li><a href='http://foursquare.com/venue/306746'>Foursquare</a> - 65 people, 3 tips</li>

<li><a href='http://gowalla.com/spots/571126'>Gowalla</a> - 10 people, 4 comments</li>

<li><a href='http://maps.google.com/maps/place?cid=11598129844502475571&amp;q=hashigo+zake&amp;hl=en&amp;cd=1&amp;ei=BSBiTLDxDYOEvgPfzKSqDg&amp;sig2=RxTDHaj8pywo70MGfMzcSg&amp;dtab=2&amp;pcsi=11598129844502475571,1&amp;geocode=FX7wif0douxqCg&amp;sll=-41.291693,174.779499&amp;sspn=0.004184,0.003358&amp;ie=UTF8&amp;ll=-41.289126,174.777267&amp;spn=0,0&amp;z=17&amp;iwloc=A'>Google places</a> - 5 maps - 2 reviews</li>

<li><a href='http://search.twitter.com/search?q=hashigo+zake'>Twitter</a> - 4 tweets in the past week</li>
</ul>

<p>Facebook has such massive uptake, that whatever it does has an impact. The understanding, technology and devices behind &#8216;location based&#8217; services are so widespread that it&#8217;s really a case of Facebook just providing the tools and they&#8217;ll probably dominate existing location based services.</p>

<p>Also - note that all of the sites have reasonably terse (or even descriptive) URLs. All except Google. They really don&#8217;t get clean URLs.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/08/12/facebook-places.html#disqus_thread">Facebook places</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Wed
              August 11
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/08/11/less-painful.html">Make LESS less painful</a></h3>
              <div class="postcontent preview">
                <p>I&#8217;ve been using <a href='http://lesscss.org/'>LESS</a> to make writing css for a <a href='http://jqtouch.com/'>jqtouch</a> app less painful. However - the less compiler is a bit awkward to use by default - if you run:</p>

<pre><code>lessc -g -w *.less</code></pre>

<p>It recompiles your scripts everytime you make a change, which is perfect, and it notifies you by growl if you have a syntax error - wonderful.</p>

<p>However - every time you get a syntax error, it also blocks the terminal that you launched less from, and you have to go to that terminal and &#8216;Press [return] to continue&#8230;&#8217;. It&#8217;s pretty annoying. The solution is to load up <code>/Library/Ruby/Gems/1.8/gems/less-1.2.21/</code> in your text editor, search for command.rb, and change the <code>run!</code> method, to disable the <code>$stdin.gets</code> and replace it as so:</p>

<pre><code># File has changed
if (not File.exists?( @destination )) or File.stat( @source ).mtime &gt; File.stat( @destination ).mtime
  print Time.now.strftime(&quot;%H:%M:%S -- &quot;) if @options[:timestamps]
  print &quot;Change detected... &quot;

  if parse
    # ...
  else 
    `touch #{@destination}`
  end
end</code></pre>

<p>I also set the growl.priority to 1 in <code>err(...)</code> to make my notifications show up in red.</p>

<pre><code>growl.priority = 1</code></pre>

<p>You then get growl notifications on error, but simply correct the error and hit save again to recompile. No more hunting to find the right terminal.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/08/11/less-painful.html#disqus_thread">Make LESS less painful</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Mon
              August 09
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/08/09/coffeescript-0.9.html">CoffeeScript 0.9</a></h3>
              <div class="postcontent preview">
                <p><a href='http://jashkenas.github.com/coffee-script/'>CoffeeScript 0.9</a> was released over the weekend. CoffeeScript is a compiler that turns .coffee files into .js files. CoffeeScript is a significant whitespace, rubyish language that makes large (and small) javascript projects much more manageable and fun.</p>

<p>I&#8217;ve been using CoffeeScript since 0.5, first with a multiplayer javascript game experiment, then more recently as part of my consulting with <a href='http://lplabs.com/'>Lonely Planet Labs</a>. It&#8217;s been interesting working with multiple developers on CoffeeScript - and seeing how it works in a production environment. I can heartily recommend it to teams that are looking to ease their javascript development.</p>

<p>CS 0.9 is a big change from 0.7.2, read <a href='http://github.com/jashkenas/coffee-script/issues/closed#issue/541'>this ticket</a> for some of the background on the change. My own reaction to the change is interesting - I was against the change at first, and only changed my mind after 0.9 was released. I was impressed by how <a href='http://github.com/jashkenas/'>Jeremy</a> got opininions and analysis from all the existing users, then quickly made such a fundamental change to the language, let people try it out in a branch - and finally decided to merge it back into stable.</p>

<p>All this - despite the fact that upgrading most coffeescript apps to 0.9 is non-trivial. Changing the symbol used for assignment will probably break most existing code. The assignment change was required to bring in yamlish object assignment which is awesome. The new release also has a host of other, non contentious improvements, around superclasses.</p>

<p>I think it&#8217;s a good reminder, that no matter how substantial a change - if you manage is right, and the benefits outweigh the costs, your community will adapt and embrace the new version.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/08/09/coffeescript-0.9.html#disqus_thread">CoffeeScript 0.9</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Sun
              August 08
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/08/08/safari-extension.html">Safari Extension</a></h3>
              <div class="postcontent preview">
                <p>I&#8217;ve been working through the extension authoring documentation for each of the browsers. I was excited when I got my little icon showing up in the Safari toolbar for the first time:</p>
<img src='/images/safari-preview.png' /><cite>Weheartplaces toolbar button</cite>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/08/08/safari-extension.html#disqus_thread">Safari Extension</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Thu
              August 05
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/08/05/design.html">Design features</a></h3>
              <div class="postcontent preview">
                <p>While redesigning this blog (I love being able to edit css and template as easily as blog posts, <a href='http://pages.github.com/'>go github pages</a>!), I found myself turning this:</p>
<img src='/images/design-staccato.png' /><cite>Ordered chronologically</cite>
<p>Into this:</p>
<img src='/images/design-wave.png' /><cite>Ordered by aesthetic</cite>
<p>I find the wave a lot more pleasing to the eye, and I still kept the primary order mostly intact. This is one of my design tenets - lay out the page by weight and balance, then work out what text you can fit into each of the boxes.</p>

<p>It&#8217;s almost the opposite of how <a href='http://37signals.com/papers/introtopatterns//index'>the signals</a> do design, but I love it.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/08/05/design.html#disqus_thread">Design features</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Wed
              August 04
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/08/04/brewdog.html">Brewdog Punk IPA</a></h3>
              <div class="postcontent preview">
                <p>I just discovered the awe inspiring <a href='http://apps.facebook.com/weheartplaces/cities/1004679663-wellington/places/935148610-flagstaff_cellars'>flagstaff cellars</a>, which is a tucked away little beershop in an unassuming corner of Melbourne.</p>

<p>The thing about this place though, is that is a stocker of Brewdog, Rogue, Epic and a number of good Australian beers - such as Matilda Alpha, Little Creatures and Moo Brew.</p>

<p>Anyway - they had this beer on special - <a href='http://www.brewdog.com/punk_ipa.php'>Punk IPA</a> by <a href='http://www.brewdog.com/'>Brewdog</a>, so I bought two and came home and tried them.</p>
<img src='/images/brewdogpunk.jpg' /><cite>A very good beer.</cite>
<p>The internet website <a href='http://www.ratebeer.com/beer/brewdog-punk-ipa/72423/'>rate beer</a> said good things about the Punk IPA, although the haters at <a href='http://beeradvocate.com/beer/profile/16315/39435'>beer advocate</a> weren&#8217;t so enamoured. The guy who drunk a Punk IPA that was 12 months past it&#8217;s best date - in particular - has a bad time with the beer.</p>

<h1 id='my_review_of_punk_ipa'>My review of Punk IPA</h1>

<p>This beer is awesome. It cost $5. I will drink it again. Probably in a few minutes when I get the other one out of the fridge. <b>5 stars.</b></p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/08/04/brewdog.html#disqus_thread">Brewdog Punk IPA</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Thu
              July 29
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/07/29/number-of-cities-in-the-world.html">Cities in the world..</a></h3>
              <div class="postcontent preview">
                <p>When you&#8217;re building an application for travellers, you come up against the problem of how do you get enough data in the system so that it&#8217;s useful for 455 cities with a population of more than one million people, 1054 with more than 500,000 and 2851 with more than 150,000 people.</p>

<p>Or to look at the problem a different way - the most visited cities in the world&#8230;</p>

<h1 id='most_visited_cities'>Most visited cities</h1>

<p>This <a href='http://en.wikipedia.org/wiki/Tourism#Most_visited_cities'>table</a> at Wikipedia shows the top <b>10 most visited</b> cities to be <i>Paris, London, Bangkok, Singapore, Kuala Lumpur, New York City, Dubai, Istanbul, Hong Kong, Shanghai</i>.</p>

<h1 id='crawling_data_for_these_cities'>Crawling data for these cities</h1>

<p>I&#8217;m not sure what the take away from this data is. Seeding 2851 cities with data seems very doable in a week of crawling, seeding the top 10 visited cities with deep data is also achievable - it&#8217;d be interesting to compare the list of top 2851 cities with the hometowns of the users of <a href='http://www.weheartplaces.com/'>weheartplaces</a>.</p>

<h1 id='the_real_take_away'>The real take away</h1>

<p>Is that it&#8217;s better to encourage users to add content to &#8216;empty&#8217; cities, than to expect to have every city to have a persuasive dataset when you launch your travel site.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/07/29/number-of-cities-in-the-world.html#disqus_thread">Cities in the world..</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Wed
              July 28
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/07/28/haversine-in-coffeescript.html">Haversine in Coffeescript</a></h3>
              <div class="postcontent preview">
                <p>The <a href='http://en.wikipedia.org/wiki/Haversine_formula'>Haversine formula</a> is a equation that can be used to calculate the straight line distance between two coordinates on a sphere. It is commonly used by geohackers to work out how far in <em>kilometres</em> it is between two latitude/latitude coordinates.</p>

<p>Remember that lat/longs are actually spherical coordinates expressed in degrees.</p>

<p>This <a href='http://kapelica.hr/kw/latlong.html'>page</a> at kapelica.hr contained a great implementation of the haversine formula in javascript, I tidied it up and ported it to coffeescript to measure distances to the nearest places in my iphone app.</p>

<pre><code>Radians: (degrees) -&gt;
  degrees /  57.2957795

Haversine: (lat1, lon1, lat2, lon2) -&gt;
  R = 6371 # km
  dLat: Radians(lat2-lat1)
  dLon: Radians(lon2-lon1)
  a: Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(Radians(lat1)) * Math.cos(Radians(lat2)) * Math.sin(dLon/2) * Math.sin(dLon/2)
  c: 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a))
  R * c</code></pre>

<p>Note that the degrees-&gt;radians conversion isn&#8217;t exact, but the results should be within the margin of error for most GPS positioning systems.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/07/28/haversine-in-coffeescript.html#disqus_thread">Haversine in Coffeescript</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Wed
              July 28
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/07/28/display-only-the-first-paragraph.html">Displaying only the first paragraph</a></h3>
              <div class="postcontent preview">
                <p>In redesigning my blog and publishing it on github pages, I wanted a simple way to show only the first paragraph of each post on the front page. The way I did it isn&#8217;t something I&#8217;m proud of - but it does show the power of css.</p>

<p>The following rule hides everything apart from the first child of a div.</p>

<pre><code>div &gt; * + *{
  display: none;
}</code></pre>

<p>It works on safari, firefox and will work on ie9.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/07/28/display-only-the-first-paragraph.html#disqus_thread">Displaying only the first paragraph</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Fri
              July 23
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/07/23/offline-manifests.html">Offline manifests</a></h3>
              <div class="postcontent preview">
                <p>I&#8217;ve been working on an html5 app for Lonely Planet, and part of the task is to make the app work offline on the iPhone. Getting it to work isn&#8217;t too hard - you need to create a <a href='http://diveintohtml5.org/offline.html'>cache.manifest</a> file and make sure it is served with the correct mime type.</p>

<h2 id='the_problem_is_online'>The problem is online</h2>

<p>When you have the phone offline and load the app, it loads in 2 seconds. When you turn the phone online again, it takes about 30 seconds to load all the javascript and so on.</p>

<h2 id='its_the_caching_rules'>It&#8217;s the caching rules</h2>

<p>We have been deploying to google app engine, and by default - app engine sets all files to expire after 10 minutes. So even though the iphone has a local copy of the files, every 10 minutes, it&#8217;ll expire the local cache and redownload everything that the manifest refers too.</p>

<h2 id='a_checklist_for_fast_online_iphone_apps'>A checklist for fast online iphone apps</h2>

<ol>
<li>Use a manifest</li>

<li>Ensure the manifest is served with the mimetype text/cache-manifest</li>

<li>Ensure the manifest has no 404 errors in it</li>

<li>Ensure the manifest and all the content in it has an expiry date in the distant future</li>

<li>White-list your network resources explicitly in the manifest</li>

<li>Use jqt.offline.js to help debug the browser behaviour</li>

<li>Tail your webserver logs and keep an eagle eye for unnecessary requests</li>
</ol>

<p>All going well, your html5 app will load instantly, and still be able to access network resources.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/07/23/offline-manifests.html#disqus_thread">Offline manifests</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Mon
              July 05
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/07/05/coffeescript.html">Coffeescript</a></h3>
              <div class="postcontent preview">
                <p>I&#8217;ve been doing a lot of coffeescript lately and can recommend it wholeheartedly.</p>

<p>That is all.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/07/05/coffeescript.html#disqus_thread">Coffeescript</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Sun
              June 20
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/06/20/skating-melbourne.html">Skating in Melbourne</a></h3>
              <div class="postcontent preview">
                <p>I just went on a big skate of melbourne CBD.</p>

<p>I started at home (nÃ¤he Southern Cross Station), then skated out to Prudence in West Melbourne. Prudence is a highly recommended bar. The beer is expensive, but the cocktails apparently are affordable. From Souther Cross to Prudence is mostly uphill, which meant that after a few beers, a few conversations and a good laugh - it was all downhill to Section 8.</p>

<p>Section 8 is a very cool bar. During the day. I went there in the evening and wasn&#8217;t so impressed. The skate was good though - it&#8217;s mostly downhill from Prudence along Victoria Street - then turn right, drop down into town (it&#8217;s a pretty steep skate through traffic down to little collins street) - and a hard left into Section 8.</p>

<p>S8 only had one beer I wanted - and it was in what australians call a &#8220;tallie&#8221; (800ml beer). I took a few drinks - decided S8 wasn&#8217;t for me, then stashed the beer in my back pocket and headed through town. There were people everywhere (and you can&#8217;t drink in public anywhere in Australia) so it took 5/10 minutes before I got out of the city (skating past the Melbourne Cricket Ground by now) and could drink the rest of my beer. It was a lovely long skate past the MCG - down a shallow smooth slope on a path surrounded in trees and grass. Had some good tunes on - nice times.</p>

<p>Then I bombed from the MCG down to Richmond - eyeballed out the gig I was going to go see at the corner bar, decided it wasn&#8217;t worth $50 to go see - then caught a tram back to Southern Cross and mellowed along Spencer street to home.</p>

<p>Melbourne. Good for skating.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/06/20/skating-melbourne.html#disqus_thread">Skating in Melbourne</a></div-->
          
          <div class="clear"></div>
        
          <div class="grid_2">
            <div class="metadate">
              Mon
              May 24
              </div>
          </div>
          
          <div class="grid_5 post">
            <h3 class="title"><a href="/2010/05/24/merging-identities.html">Merging identities</a></h3>
              <div class="postcontent preview">
                <p>I&#8217;ve set this blog up on Github pages using Jekyll. My old posts may find their way here&#8230;.</p>
              </div>
          </div>
          
          <!--div class="comment-link"><a href="/2010/05/24/merging-identities.html#disqus_thread">Merging identities</a></div-->
          
          <div class="clear"></div>
        

      </div>

      <div class="grid_3 sidebar">
        
        <h2>
          Work with me
        </h2>
        
        <p>
          <img src="/images/37-suitcase.png" width="20" style="float: left; padding: 0 10px 40px 0"/> I may be available for hire,
          <a href="mailto:bnolan@gmail.com">email</a> or <a href="callto:bennolan">call me</a>.
        </p>

        <h2>
          My Tools
        </h2>
        
        <ul>
          <li><a href="http://jquery.com/">jQuery</a>, <a href="http://www.w3.org/TR/html5/">HTML5</a> and <a href="http://www.w3.org/Style/CSS/current-work">CSS3</a></li>
          <li><a href="http://nodejs.org/">node.js</a> or <a href="http://rubyonrails.org/">Ruby on Rails</a></li>
          <li><a href="http://www.mongodb.org/">MongoDB</a> or <a href="http://www.postgresql.org/">PostgreSQL</a></li>
        </ul>

        <h2>
          Previous Clients
        </h2>
        
        <ul>
          <li><a href="http://www.lonelyplanet.com/">Lonely Planet</a></li>
          <li><a href="http://www.sony.net/Fun/design/profile/globallocations/losangeles.html">Sony Los Angeles</a></li>
          <li><a href="http://www.copenhagen.dk/dk/">Copenhagen Museum</a></li>
          <li><a href="http://www.nzx.com/">New Zealand Exchange</a></li>
          <li><a href="http://www.autoscout24.de/">Autoscout 24 Munich</a></li>
          <li><a href="http://www.koziarski.com/">Koziarski Software</a></li>
          <li><a href="http://www.traveliq.net/">Travel IQ</a></li>
          <li><a href="http://www.zoomin.co.nz/">Zoomin</a></li>
          <li><a href="http://www.sxip.com/">Sxip</a></li>
        </ul>

        <h2>
          Find me online
        </h2>
        
        <ul class="findmeonline">
          <li><a href="/atom.xml"><img src="/images/rss.png" /> atom feed</a></li>
          <li><a href="http://delicious.com/benn/"><img src="/images/delicious.png" /> delicious</a></li>
          <li><a href="http://github.com/bnolan/"><img src="/images/github.png" /> github</a></li>
          <li><a href="http://flickr.com/photos/benn"><img src="/images/flickr.png" /> flickr</a></li>
          <li><a href="http://twitter.com/bnolan"><img src="/images/twitter.png" /> twitter</a></li>
          <li><a href="http://www.facebook.com/bennolan"><img src="/images/facebook.png" /> facebook</a></li>
        </ul>
        
      </div>

      <div class="push"></div>
    </div>

    <br style="clear: both" />

    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-4944761-3']);
      _gaq.push(['_setDomainName', '.bennolan.com']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    
  </body>
</html>
